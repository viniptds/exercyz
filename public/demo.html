<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <script src="/config.js"></script>
    <!-- Google tag (gtag.js) -->
    <script>
      if (window.GTM_TAG) {
        var gtmScript = document.createElement("script");
        gtmScript.async = true;
        gtmScript.src =
          "https://www.googletagmanager.com/gtm.js?id=" + window.GTM_TAG;
        document.head.appendChild(gtmScript);
        window.dataLayer = window.dataLayer || [];
        function gtag() {
          dataLayer.push(arguments);
        }
        gtag("js", new Date());

        gtag("config", window.GTM_TAG);
      }
    </script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Audio Filter with Hands</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="phone-wrap">
      <div class="phone">
        <div class="btn left top"></div>
        <div class="btn left middle"></div>
        <div class="btn left bottom"></div>
        <div class="btn right"></div>

        <div class="screen">
          <div class="island" aria-hidden="true"></div>
          <!-- Start content -->
          <div class="wrap">
            <div id="stage">
              <div id="video-zone">
                <video
                  id="video"
                  class="reverse"
                  playsinline
                  autoplay
                  muted
                ></video>
              </div>
              <canvas id="overlay"></canvas>
              <div id="hud">
                <div class="row">
                  <div id="counter" class="text-white">âœ‹ 0</div>
                  <button id="flip" class="text-white">Switch camera</button>
                </div>
                <div id="status" class="small text-white">Starting...</div>
              </div>
              <div id="menu">
                <button class="text-white hidden" id="startBtn">Play</button>

                <button class="text-white hidden" id="stopBtn">Pause</button>
                <div class="hidden text-white" id="filterPercent">0%</div>
                <!-- TODO: record track -->
                <!-- <button class="small" id="recordBtn">Record</button> -->
              </div>
            </div>
            <div class="small text-white tip">
              Tip: a good lighting improves accuracy.
            </div>

            <!-- Audio options -->
            <!-- Option 1: embedded audio -->
            <audio id="audio" class="hidden" controls loop></audio>

            <!-- Option 2: Spotify audio -->
            <!-- TODO: Add spotify audio source -->
            <!-- embedded Spotify -->
          </div>
          <!-- End content -->

          <div class="home-indicator" aria-hidden="true"></div>
        </div>
      </div>
    </div>

    <script>
      const audioEl = document.getElementById("audio");
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const source = audioCtx.createMediaElementSource(audioEl);
      const video = document.getElementById("video");

      const filter = audioCtx.createBiquadFilter();
      filter.type = "lowpass";
      filter.frequency.value = 20000; // start with no cut
      source.connect(filter).connect(audioCtx.destination);

      const debug = true;
      let running = false;
    </script>
    <script type="module" src="index.js"></script>
    <script type="module" src="demo.js"></script>
  </body>
</html>
