<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Contador de Dedos (Web + MediaPipe)</title>
    <style>
      html,
      body {
        margin: 0;
        height: 100%;
        background: #0b0b0c;
        color: #eee;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          Ubuntu;
      }
      .hidden {
        display: none;
      }
      .wrap {
        display: grid;
        place-items: center;
        height: 100%;
        padding: 16px;
        gap: 16px;
      }
      #stage {
        position: relative;
        /* width: min(96vw, 960px); */
        width: min(42vw, 480px);
        min-height: 720px;
        aspect-ratio: 9/16;
      }
      video,
      canvas {
        position: absolute;
        inset: 0;
        max-width: 100%;
        height: 100%;
        /* transform: scale3d(1.5, 1.5, -1.5); */
        /* transform: translate(-50%, -50%); */
        border-radius: 16px;
        transform: scaleX(-1);
      }
      #video-zone {
        position: relative;
        width: 100%;
        aspect-ratio: 9/16;
        overflow: hidden;
      }
      #video {
        /* width: 100%;
        height: auto;
        max-height: 100vh;
        object-fit: cover; */
        /*fills space without distortion */
      }
      #hud {
        position: absolute;
        left: 12px;
        top: 12px;
        background: rgba(0, 0, 0, 0.5);
        padding: 8px 12px;
        border-radius: 12px;
        font-weight: 600;
        backdrop-filter: blur(4px);
      }
      #menu {
        position: absolute;
        bottom: 12px;
        align-items: center;
      }
      #counter {
        font-size: 28px;
      }
      #status {
        font-size: 12px;
        opacity: 0.8;
      }
      .row {
        display: flex;
        gap: 10px;
        align-items: center;
      }
      button {
        all: unset;
        padding: 10px 14px;
        border-radius: 12px;
        background: #1f2937;
        cursor: pointer;
      }
      button:hover {
        background: #374151;
      }
      .small {
        font-size: 12px;
        opacity: 0.8;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div id="stage">
        <div id="video-zone">
          <video id="video" playsinline autoplay muted></video>
        </div>
        <canvas id="overlay"></canvas>
        <div id="hud">
          <div class="row">
            <div id="counter">✋ 0</div>
            <button id="flip">Trocar câmera</button>
          </div>
          <div id="status" class="small">Inicializando…</div>
        </div>
        <div id="menu">
          <button class="hidden" id="startBtn">Iniciar</button>
          <button class="hidden" id="stopBtn">Parar</button>

          <!-- TODO: record track -->
          <!-- <button class="small" id="recordBtn">Record</button> -->
        </div>
      </div>
      <div class="small">Dica: boa iluminação melhora a precisão.</div>
      <!-- Audio options -->
      <!-- Option 1: embedded audio -->
      <audio src="./audio.mp3" id="audio" controls loop></audio>

      <!-- Option 2: Spotify audio -->
      <!-- TODO: Add spotify audio source -->
      <!-- embedded Spotify -->
    </div>
    <script>
      const audioEl = document.getElementById("audio");
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const source = audioCtx.createMediaElementSource(audioEl);
      const video = document.getElementById("video");
      
      const filter = audioCtx.createBiquadFilter();
      filter.type = "lowpass";
      filter.frequency.value = 20000; // start with no cut
      source.connect(filter).connect(audioCtx.destination);

      const debug = true;
      let running = false;
    </script>
    <script type="module" src="index.js"></script>
    <script type="module" src="demo.js"></script>
    <!-- <script type="module" src="deadlift.js"></script> -->
    <!-- <script type="module" src="boxing.js"></script> -->
  </body>
</html>
